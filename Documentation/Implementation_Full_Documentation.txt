Title: End-to-End Implementation and Configuration Details for Internship Supervision Workflow

Overview
You asked for a complete supervision workflow where students, staff, and admins collaborate to manage internship progress. The system must:
- Enforce a structured flow: profile completion → supervisor application → student supervision request → admin validation/assignment → tasks and submissions → grading and progress tracking.
- Enforce constraints: one student ↔ one supervisor, supervisor capacity, visibility and access boundaries.
- Track progress for students (simple percentage on dashboard) and provide a detailed, admin-only tracking page.
- Keep your project’s style/format intact and remain dependent on your XAMPP MySQL database.

This document explains everything implemented, why it was done, the files created/modified, database schema changes, routes/controllers/models/views, and how to operate the flow, including the commands used.


A. Summary of What Was Implemented
1) Database layer (new tables)
   - supervision_requests: Records student requests for supervision, including the requested supervisor and the admin to validate/assign.
   - supervisor_assignments: Enforces the one-student-to-one-supervisor rule and tracks which admin assigned the pairing.
   - internship_tasks: Tasks created by supervisors for their assigned students.
   - task_submissions: Submissions from students for each task, including optional file and grading.

2) Application logic and access boundaries
   - Students:
     - Request supervision by selecting an available, admin-approved supervisor and the admin they want to validate.
     - Submit task work (file/text) only to tasks created by their assigned supervisor.
     - See their own overall progress percentage on their dashboard.
   - Supervisors (staff approved by admin):
     - Create tasks with due dates and max scores.
     - View submissions for their tasks and grade or reject them.
   - Admins:
     - Validate and assign supervision for pending student requests (capacity enforced).
     - View detailed tracking for students they assigned (overall progress, per-task percentages, timeliness info).

3) Progress tracking
   - ProgressService computes progress % from graded submissions using:
     - Grade percentage (grade_score / max_score * 100)
     - Timeliness factor: bonus for on-time; mild penalties for late.
   - Safe behavior: If tables aren’t migrated yet, it returns 0% to avoid SQL errors.

4) Blade fix
   - Cleaned resources/views/user/dashboard.blade.php to resolve “Cannot end a section without first starting one”.

5) Data cleanup/maintenance command
   - Extended the existing PurgeAllUsers command to also purge the new tables.

6) Migrations executed and user purge performed (in your project context)
   - Migrations were run against MySQL; all new tables created.
   - All existing users and related data were purged upon your request.


B. Detailed File-by-File Changes
1) New database migrations (database/migrations)
   - 2026_01_03_000001_create_supervision_requests_table.php
     Fields:
       id (PK)
       student_id (FK → users)
       requested_supervisor_id (FK → users)
       requested_admin_id (FK → users)
       status enum: pending | approved | rejected | cancelled (default pending)
       note text nullable
       timestamps

   - 2026_01_03_000002_create_supervisor_assignments_table.php
     Fields:
       id (PK)
       student_id (FK → users, unique)  // enforces one student → one supervisor
       supervisor_id (FK → users)
       assigned_by_admin_id (FK → users)
       assigned_at timestamp nullable
       active boolean default true
       timestamps

   - 2026_01_03_000003_create_internship_tasks_table.php
     Fields:
       id (PK)
       supervisor_id (FK → users)
       title string
       description text nullable
       due_at timestamp nullable
       max_score unsigned int default 100
       active boolean default true
       timestamps

   - 2026_01_03_000004_create_task_submissions_table.php
     Fields:
       id (PK)
       task_id (FK → internship_tasks)
       student_id (FK → users)
       submitted_at timestamp nullable
       file_path string nullable (storage/app/public/submissions)
       content text nullable
       grade_score unsigned int nullable
       graded_at timestamp nullable
       status enum: submitted | graded | rejected (default submitted)
       unique (task_id, student_id)
       timestamps

2) New Eloquent models (app/Models)
   - SupervisionRequest.php
     Fillable: student_id, requested_supervisor_id, requested_admin_id, status, note
     Relations: student(), requestedSupervisor(), requestedAdmin()

   - SupervisorAssignment.php
     Fillable: student_id, supervisor_id, assigned_by_admin_id, assigned_at, active
     Casts: assigned_at (datetime), active (boolean)
     Relations: student(), supervisor(), assignedBy()

   - InternshipTask.php
     Fillable: supervisor_id, title, description, due_at, max_score, active
     Casts: due_at (datetime), active (boolean)
     Relations: supervisor(), submissions()

   - TaskSubmission.php
     Fillable: task_id, student_id, submitted_at, file_path, content, grade_score, graded_at, status
     Casts: submitted_at (datetime), graded_at (datetime)
     Relations: task(), student()

3) Progress service (app/Services/ProgressService.php)
   - computeStudentProgress(int $studentId, ?int $supervisorId = null): float
     Steps:
       a) Early-safe exit: if Schema::hasTable('task_submissions') is false, return 0.0 (avoids SQL errors on fresh setup).
       b) Query graded submissions for the student (optionally filtered by supervisor via task relationship).
       c) For each submission:
          - gradePct = max(0, min(100, (grade_score / max_score) * 100))
          - timeliness factor:
              • +10% bonus if submitted on/before due_at
              • up to -20% penalty based on days late (capped to retain at least 80%)
          - bounded result: 0..100
       d) Return the average of per-task adjusted percentages (rounded to 2 decimals). If no submissions, return 0.

4) Controllers (app/Http/Controllers)
   - StudentSupervisionController.php
     create():
       • Builds availableSupervisors from approved SupervisorApplication with capacity remaining (current assignments count < max_students).
       • Loads admins for dropdown selection (students choose the admin to validate/assign).
       • Returns view user/request-supervision.
     store(Request):
       • Validates requested_supervisor_id, requested_admin_id.
       • Cancels any existing pending request for the same student to ensure one active pending at a time.
       • Creates a new pending SupervisionRequest.

   - AdminAssignmentController.php
     index():
       • Shows pending SupervisionRequest where requested_admin_id == current admin.
     approve(SupervisionRequest $request):
       • Authorizes that current user is the requested admin.
       • Capacity check: find approved SupervisorApplication for requested supervisor; ensure assignments count < max_students.
       • updateOrCreate on SupervisorAssignment by student_id to enforce one student → one supervisor and set assigned_by_admin_id, assigned_at, active=true.
       • Mark SupervisionRequest as approved.
     reject(SupervisionRequest $request):
       • Authorizes and marks request as rejected.

   - SupervisorTaskController.php
     index():
       • Lists tasks created by the supervisor.
       • Lists submissions for tasks owned by the supervisor (with task and student eager-loaded).
     create() → view for creating a task.
     store(Request):
       • Validates input and creates a new InternshipTask for the current supervisor.
     grade(TaskSubmission $submission, Request):
       • Ensures the current user owns the task (supervisor_id matches), validates grade, updates grade_score/graded_at/status.

   - StudentSubmissionController.php
     store(InternshipTask $task, Request):
       • Ensures the student is assigned to the task’s supervisor (via SupervisorAssignment) and active.
       • Accepts optional file (stored in public/submissions) and/or text content.
       • updateOrCreate on TaskSubmission keyed by (task_id, student_id), sets submitted_at and status=submitted.

   - AdminTrackingController.php
     show(User $student):
       • Ensures the current admin is the one who assigned this student (authorization through SupervisorAssignment.assigned_by_admin_id).
       • Loads submissions (with tasks), computes overall progress with ProgressService.
       • Builds per-task details (grade %, timeliness flag, timestamps) for the detailed admin view.

   - DashboardController.php (modified)
     userDashboard(): now resolves ProgressService and passes $progress to the user dashboard view.

5) Routes (routes/web.php) — added and preserved your format
   - Student:
     GET /user/supervision/request → StudentSupervisionController@create (name: user.supervision.request)
     POST /user/supervision/request → StudentSupervisionController@store (name: user.supervision.request.store)
     POST /user/tasks/{task}/submit → StudentSubmissionController@store (name: user.tasks.submit)
   - Staff (supervisor):
     GET /staff/tasks → SupervisorTaskController@index (name: staff.tasks.index)
     GET /staff/tasks/create → SupervisorTaskController@create (name: staff.tasks.create)
     POST /staff/tasks → SupervisorTaskController@store (name: staff.tasks.store)
     POST /staff/submissions/{submission}/grade → SupervisorTaskController@grade (name: staff.submissions.grade)
   - Admin:
     GET /admin/assignments → AdminAssignmentController@index (name: admin.assignments.index)
     POST /admin/assignments/{request}/approve → AdminAssignmentController@approve (name: admin.assignments.approve)
     POST /admin/assignments/{request}/reject → AdminAssignmentController@reject (name: admin.assignments.reject)
     GET /admin/tracking/{student} → AdminTrackingController@show (name: admin.tracking.show)

6) Views (resources/views)
   - layouts/app.blade.php: unchanged in structure; used as the app shell.
   - user/dashboard.blade.php: replaced with a clean version that includes:
     • Welcome header
     • Student’s overall progress section (if provided)
     • Quick links
   - user/request-supervision.blade.php: student form with dropdowns for supervisor and admin + optional note.
   - staff/tasks/index.blade.php: lists supervisor’s tasks and incoming submissions; inline grading form.
   - staff/tasks/create.blade.php: form to create a task (title, description, due date, max score).
   - admin/assignments/index.blade.php: pending supervision requests (for this admin) with approve/reject actions.
   - admin/tracking/show.blade.php: detailed per-task table and overall percentage for a specific student (only for assigning admin).

7) Console command for cleanup (app/Console/Commands/PurgeAllUsers.php)
   - Extended the tables list to include the new entities in a safe order (children first):
     task_submissions, internship_tasks, supervisor_assignments, supervision_requests, message_user_reads, messages, personal_data, profiles, supervisor_applications, admins, staff, students, users.
   - Removed explicit transaction (begin/commit/rollback) to avoid the earlier environment error and rely on FK disable/enable while truncating/deleting.
   - Usage:
       php artisan app:purge-all-users --force


C. Environment and Database Configuration Notes (XAMPP / MySQL)
- .env should be configured to use your local XAMPP MySQL instance, for example:
    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=new_internship_management_project
    DB_USERNAME=root
    DB_PASSWORD=your_password_or_empty

- Ensure pdo_mysql is enabled in PHP used by both CLI and Apache (XAMPP default is usually fine).
- If using root with NO password (common in XAMPP), leave DB_PASSWORD blank in .env.


D. Commands Executed (in order)
1) Clear cached config and views (avoid stale config issues):
   php artisan config:clear
   php artisan optimize:clear
   php artisan view:clear

2) Run migrations:
   php artisan migrate --force

3) Link storage (for file uploads):
   php artisan storage:link

4) Purge all users and related data (as requested):
   php artisan app:purge-all-users --force


E. How to Use the Workflow End-to-End
1) Create or seed users:
   - Admin user: can validate/assign and view detailed tracking.
   - Staff user: can apply as a supervisor; once approved, creates tasks and grades submissions.
   - Student user: requests supervision and submits tasks.

2) Staff applies to supervise:
   - Route: GET /staff/supervisor/apply → submit the application indicating max_students.
   - Admin approves via existing admin/supervisors page (already present in your project) so the staff becomes an approved supervisor.

3) Student requests supervision:
   - Route: GET /user/supervision/request
     • Choose an approved supervisor with remaining capacity
     • Choose the admin to validate/assign
     • Submit

4) Admin validates/assigns:
   - Route: GET /admin/assignments
     • Approve or reject a pending request
     • Approve will:
       - Enforce capacity
       - Upsert SupervisorAssignment for the student (enforces one-student-to-one-supervisor)

5) Supervisor creates tasks and grades:
   - Create tasks: GET /staff/tasks/create → POST /staff/tasks
   - View submissions and grade: GET /staff/tasks → POST /staff/submissions/{submission}/grade

6) Student submits work:
   - Route: POST /user/tasks/{task}/submit
     • Upload file or enter text content (file stored under public/submissions via storage/app/public)

7) Progress tracking:
   - Student dashboard: GET /user/dashboard → overall progress % only (minimal info)
   - Admin detailed tracking: GET /admin/tracking/{student}
     • Shows per-task grade %, timeliness (on time vs late), submission/graded timestamps, status, and overall %


F. Security and Access Boundaries
- Students:
  • Can only submit to tasks created by the supervisor they are assigned to (checked in StudentSubmissionController).
  • Can only see their own progress (shown on their dashboard).
- Supervisors:
  • Can only grade submissions for tasks they own.
- Admins:
  • Can only view detailed tracking for students they themselves assigned (AdminTrackingController authorization check).
- You additionally have RoleMiddleware already configured in your project to gate /user, /staff, and /admin route groups.


G. Known Considerations & Future Enhancements
- Policies: For even stricter enforcement, add Laravel Policy classes for each resource (e.g., TaskSubmissionPolicy, SupervisorAssignmentPolicy) in addition to controller checks.
- Supervisor capacity tracking is based on current count of SupervisorAssignment for a supervisor versus SupervisorApplication.max_students.
- Progress formula is adjustable:
  • Timeliness bonus/penalty can be tuned.
  • You can introduce weightings for tasks or for grading vs timeliness components.
- UI: You may add a link to "Request Supervision" from the student dashboard quick links for convenience.
- Seeds: Add seeders to create one admin, one approved supervisor (with capacity), one student, a sample task, and a sample submission to demo the flow.


H. Complete List of Files Added/Modified (with purpose)
- Added (Migrations):
  • database/migrations/2026_01_03_000001_create_supervision_requests_table.php
  • database/migrations/2026_01_03_000002_create_supervisor_assignments_table.php
  • database/migrations/2026_01_03_000003_create_internship_tasks_table.php
  • database/migrations/2026_01_03_000004_create_task_submissions_table.php

- Added (Models):
  • app/Models/SupervisionRequest.php — persistence for student supervision requests.
  • app/Models/SupervisorAssignment.php — current student-supervisor assignment; enforces one-to-one.
  • app/Models/InternshipTask.php — tasks created by supervisors for students.
  • app/Models/TaskSubmission.php — student submissions and grades for tasks.

- Added (Service):
  • app/Services/ProgressService.php — computes student progress percentage safely.

- Added (Controllers):
  • app/Http/Controllers/StudentSupervisionController.php — student request pages and handling.
  • app/Http/Controllers/AdminAssignmentController.php — pending requests and assignment approval/rejection.
  • app/Http/Controllers/SupervisorTaskController.php — supervisor task management and grading.
  • app/Http/Controllers/StudentSubmissionController.php — student submissions to tasks.
  • app/Http/Controllers/AdminTrackingController.php — admin-only detailed progress tracking for assigned students.

- Modified (Controller):
  • app/Http/Controllers/DashboardController.php — now calculates progress for the signed-in student and passes it to the dashboard view.

- Modified (Routes):
  • routes/web.php — added routes for student supervision requests, supervisor tasks & grading, admin assignments, and admin tracking; kept your group format.

- Added (Views):
  • resources/views/user/request-supervision.blade.php — student supervision request form (supervisor + admin dropdowns).
  • resources/views/staff/tasks/index.blade.php — list of tasks + submissions with grading form.
  • resources/views/staff/tasks/create.blade.php — create new task.
  • resources/views/admin/assignments/index.blade.php — pending requests for this admin.
  • resources/views/admin/tracking/show.blade.php — detailed tracking for a student (admin-only).

- Replaced (View fix):
  • resources/views/user/dashboard.blade.php — cleaned section to fix Blade error and show progress.

- Modified (Console):
  • app/Console/Commands/PurgeAllUsers.php — extended to purge new tables and removed explicit transaction block to avoid environment errors.


I. Operational Checklist
- Ensure XAMPP MySQL is running and .env points to it.
- Run:
  php artisan config:clear
  php artisan migrate --force
  php artisan storage:link
  php artisan app:purge-all-users --force  (only when you want a clean slate)
- Create fresh users and follow the flow as described in Section E.


End of document.
